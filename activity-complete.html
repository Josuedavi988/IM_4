<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FitUp – Aktivität gespeichert</title>
  <link rel="stylesheet" href="styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="container" style="background-color: #4a5d80; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 32px;">
    <h1 class="logo" style="margin-bottom: 32px;">FitUp</h1>

    <div class="activity-complete-icon" style="margin-bottom: 32px;">
      <svg width="128" height="128" viewBox="0 0 24 24" fill="none" stroke="#1e293b" stroke-width="1">
        <path d="M18 4a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4z" />
        <path d="M18 12a8 8 0 0 1-8 8A8 8 0 0 1 2 12a8 8 0 0 1 8-8" />
        <path d="M18 8v16" />
        <path d="M18 12l-4 4" />
        <path d="M18 12l4 4" />
      </svg>
    </div>

    <div class="activity-complete-title">STARK!</div>
    <div class="activity-complete-subtitle">DEINE AKTIVITÄT WURDE GESPEICHERT</div>

    <a href="calendar.html" class="button" style="width: 192px; margin-top: 32px;">beenden</a>
  </div>

  <script>
    const sport = localStorage.getItem("selectedSport") || "Unbekannt";
    const timeString = localStorage.getItem("timerResult") || "ZEIT 00:00";

    const parts = timeString.split(" ")[1].split(":");
    const durationInSeconds = parseInt(parts[0]) * 60 + parseInt(parts[1]);

    const date = new Date().toISOString().split("T")[0];

    fetch("system/api/save-activity.php", {
      method: "POST",
      headers: { "Content-Type": "application/x-www-form-urlencoded" },
      body: new URLSearchParams({
        sport: sport,
        duration: durationInSeconds,
        date: date
      })
    })
    .then(async res => {
      const text = await res.text();
      try {
        const json = JSON.parse(text);
        console.log("Aktivität gespeichert:", json);
      } catch (err) {
        console.error("Fehlerhafte JSON-Antwort:", text);
        alert("Fehler beim Speichern: Serverantwort ist ungültig.");
      }
    })
    .catch(err => {
      console.error("Fehler beim Speichern der Aktivität:", err);
      alert("Fehler beim Speichern:\n" + err.message);
    });
  </script>
</body>
</html>
